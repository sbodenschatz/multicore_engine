before_script:
  - mkdir -p multicore_engine_{core,core_tests,demo,parsers,load_unit_gen,pack_file_gen}/build/{bin,obj-{gcc,clang}-{debug,release}}

scan-build:
  script:
  - premake5 --cc=gcc gmake
  - export CC=clang
  - export CXX=clang++
  - scan-build --status-bugs make -j $[$(grep -c ^processor /proc/cpuinfo)+2] config=debug CC=clang CXX=clang++
  tags:
  - cpp

gcc-debug-build:
  script:
  - premake5 --cc=gcc gmake
  - export CC=gcc
  - export CXX=g++
  - make -j $[$(grep -c ^processor /proc/cpuinfo)+2] config=debug CC=gcc CXX=g++
  - multicore_engine_core_tests/build/bin/multicore_engine_core_tests-gcc-debug --report_level=short
  tags:
  - cpp

gcc-release-build:
  script:
  - premake5 --cc=gcc gmake
  - export CC=gcc
  - export CXX=g++
  - make -j $[$(grep -c ^processor /proc/cpuinfo)+2] config=release CC=gcc CXX=g++
  - multicore_engine_core_tests/build/bin/multicore_engine_core_tests-gcc-release --report_level=short
  - cp multicore_engine_demo/build/bin/multicore_engine_demo-gcc-release demo-gcc
  - cp multicore_engine_load_unit_gen/build/bin/multicore_engine_load_unit_gen-gcc-release load_unit_gen-gcc
  - cp multicore_engine_pack_file_gen/build/bin/multicore_engine_pack_file_gen-gcc-release pack_file_gen-gcc
  tags:
  - cpp
  artifacts:
    name: "mce_${CI_BUILD_REF_NAME}_${CI_BUILD_ID}_${CI_BUILD_REF}_${CI_BUILD_NAME}"
    paths:
    - demo-gcc
    - load_unit_gen-gcc
    - pack_file_gen-gcc

clang-debug-build:
  script:
  - premake5 --cc=clang gmake
  - export CC=clang
  - export CXX=clang++
  - make -j $[$(grep -c ^processor /proc/cpuinfo)+2] config=debug CC=clang CXX=clang++
  - multicore_engine_core_tests/build/bin/multicore_engine_core_tests-clang-debug --report_level=short
  tags:
  - cpp

clang-release-build:
  script:
  - premake5 --cc=clang gmake
  - export CC=clang
  - export CXX=clang++
  - make -j $[$(grep -c ^processor /proc/cpuinfo)+2] config=release CC=clang CXX=clang++
  - multicore_engine_core_tests/build/bin/multicore_engine_core_tests-clang-release --report_level=short
  - cp multicore_engine_demo/build/bin/multicore_engine_demo-clang-release demo-clang
  - cp multicore_engine_load_unit_gen/build/bin/multicore_engine_load_unit_gen-clang-release load_unit_gen-clang
  - cp multicore_engine_pack_file_gen/build/bin/multicore_engine_pack_file_gen-clang-release pack_file_gen-clang
  tags:
  - cpp
  artifacts:
    name: "mce_${CI_BUILD_REF_NAME}_${CI_BUILD_ID}_${CI_BUILD_REF}_${CI_BUILD_NAME}"
    paths:
    - demo-clang
    - load_unit_gen-clang
    - pack_file_gen-clang

api-doc:
  script:
  - doxygen Doxyfile
  - cd doc/latex
  - pdflatex refman.tex
#  - bibtex refman
  - makeindex refman
  - pdflatex refman.tex
  - pdflatex refman.tex
  - mv refman.pdf ../..
  tags:
  - latex
  - doxygen
  artifacts:
    name: "mce_${CI_BUILD_REF_NAME}_${CI_BUILD_ID}_${CI_BUILD_REF}_${CI_BUILD_NAME}"
    paths:
    - refman.pdf

